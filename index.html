<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Polling Station 87</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- âœ… Firebase v9 (MODULAR) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  window.firebaseApp = initializeApp({
    apiKey: "AIzaSyCybmzCk3M8jV_255SbRGkGPWLAz2lgayE",
    authDomain: "bijus-app-52978.firebaseapp.com",
    databaseURL: "https://bijus-app-52978.firebaseio.com",
    projectId: "bijus-app-52978",
    storageBucket: "bijus-app-52978.firebasestorage.app",
    messagingSenderId: "796288544713",
    appId: "1:796288544713:web:643d5dee81c51e5aaec218"
  });

  window.db = getDatabase(window.firebaseApp);
</script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

<link rel="stylesheet" href="style.css">

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#2563eb">

</head>

<body>
<script>
  if(localStorage.getItem("isAdmin") !== "1"){
    location.href = "login.html";
  }
</script>


<div class="page">

  <!-- Overlay for mobile -->
  <div id="sidebarOverlay" class="sidebar-overlay"></div>

  <!-- SIDEBAR -->
  <aside class="sidebar">
  <button class="sidebar-close-btn">âœ–</button>

  <h2 class="sidebar-title">Controls Panel</h2>

  <div class="sidebar-controls">

    <label class="toggle-item">
      <input type="checkbox" id="swFilters">
      <span>Filters</span>
    </label>
    
    <label class="toggle-item">
  <input type="checkbox" id="swNotes">
  <span>Show Notes</span>
</label>
<label class="toggle-item">
  <input type="checkbox" id="swBulkMove">
  <span>Bulk Move Mode</span>
</label>

    <label class="toggle-item">
      <input type="checkbox" id="swShowMissing">
      <span>Missing Serials</span>
    </label>
    
<label class="toggle-item">
  <input type="checkbox" id="swHouseViewBtn">
  <span>House View Button</span>
</label>
  </div>
  <label class="toggle-item">
  <input type="checkbox" id="swSearch">
  <span>Search</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swAge">
  <span>Age Filter</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swHouse">
  <span>House Filter</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swMobile">
  <span>Mobile Filter</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swVerified">
  <span>Verified Filter</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swSort">
  <span>Sort</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swAddVoter">
  <span>Add Voter</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swDeletedList">
  <span>VIEW DELETED LIST</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swStats">
  <span>Stats</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swMuslimJump">
  <span>Muslim Jump</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swUnverifiedMuslimJump">
  <span>Unverified Muslim</span>
</label>


<label class="toggle-item">
  <input type="checkbox" id="swReset">
  <span>Reset Button</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swPagination">
  <span>Pagination</span>
</label>

<label class="toggle-item">
  <input type="checkbox" id="swReport">
  <span>Report Button</span>
</label>
<hr class="sb-divider">

<button id="logoutBtn"
  style="
    width:100%;
    padding:12px;
    border-radius:12px;
    border:none;
    background:#dc2626;
    color:#fff;
    font-size:15px;
    font-weight:700;
    cursor:pointer;
  ">
  ğŸšª Logout
</button>

</aside>


  <!-- Toggle -->
  <div class="top-action-bar">
  <button id="toggleSidebarBtn" class="houses-btn">
    â˜° Houses
  </button>

  <div class="ps-header">
    <i class="bi bi-geo-alt-fill"></i>
    <span>Polling Station</span>
    <strong>90</strong>
  </div>
  <a href="pending.html" class="pending-btn" id="pendingBtn">
  â³ Pending
  <span id="pendingCount" class="pending-count">0</span>
</a>

</div>
<!-- ğŸ”¢ ONLY TOTAL -->
<div class="total-bar">
  <div class="stat-chip total-chip">
    Total:
    <span id="statTotal" class="value" data-last="0">0</span>
    <span id="totalArrow" class="total-arrow"></span>
  </div>
   <button id="exportPDFBtn" class="tool-btn">
  ğŸ–¨ Export PDF
</button>
</div>
<!-- âœ… NEW MARQUEE LINE -->
<div class="name-marquee">
  <marquee behavior="scroll" direction="left" scrollamount="4">
    âœ¨ BIJUSH KUMAR ROY âœ¨
  </marquee>
</div>
  <!-- MAIN -->
  <main class="main">
    <div class="card-main">

     

      <!-- â­ STICKY GLASS HEADER (ALL INSIDE HERE) -->
      <div class="sticky-header">
           <div class="sticky-inner">

        <!-- BREADCRUMB -->
        <div id="breadcrumb" class="breadcrumb">
          <i class="bi bi-house-door-fill"></i><span>Home</span>
          <i class="bi bi-chevron-right"></i>
          <i class="bi bi-geo-alt-fill"></i><span>Polling Station</span>
          <i class="bi bi-chevron-right"></i>
          <i class="bi bi-houses-fill"></i>
          <strong id="breadcrumbHouse">All Houses</strong>
        </div>
        
        
        
        <div class="compact-toolbar">

  <div class="toolbar-row">

  <button id="openAddVoter"
    class="tool-btn"
    style="background:#22c55e;color:#fff;">
    â• Add Voter
  </button>

  <button id="deletedBtn" class="tool-btn danger">
    ğŸ—‘ï¸ VIEW DELETED LIST
  </button>

</div>

  <select id="filterHouseToggle" class="tool-select">
    <option value="">House View</option>
    <option value="off">Off All Houses</option>
    <option value="on">On All Houses</option>
  </select>

</div>
        
       <!-- FILTERS -->
        <div class="filter-bar" id="filterBar">
    <select id="filterAge">
      <option value="">Age</option>
      <option value="18-25">18â€“25</option>
      <option value="26-40">26â€“40</option>
      <option value="41-60">41â€“60</option>
      <option value="60-200">60+</option>
    </select>

    <input id="filterHouse" placeholder="House (e.g. 1-30)" 
       style="flex:1 1 120px;min-width:110px;padding:7px 9px;
              border-radius:999px;border:1px solid #d1d5db;
              background:#f9fafb;font-size:12px;">

    <select id="filterMobile">
      <option value="">Mobile</option>
      <option value="has">Has Mobile</option>
      <option value="none">No Mobile</option>
    </select>
    
    
    <select id="filterVerified">
  <option value="">Verified</option>
  <option value="yes">Verified Only</option>
  <option value="no">Unverified Only</option>
</select>

    <!-- â­ NEW: SORT DROPDOWN -->
    <select id="sortBy">
      <option value="default">Default</option>
<option value="serial-asc">Serial: Low â†’ High</option>
<option value="serial-desc">Serial: High â†’ Low</option>
    </select>
</div>

       
<!-- ğŸ”½ TOGGLE AREA START -->

<div id="filterToggleArea" style="display:none;">
    
    
    
        <!-- SEARCH -->
        <input id="search" type="text" placeholder="Search by name / house / serial / BYPâ€¦">
        
        
        
        
        <!-- Report Showing buttong -->
        
        <button id="toggleReportBtn" 
        style="margin-top:10px;padding:8px 12px;
        border-radius:8px;border:1px solid #444;">
ğŸ“Š Show Report
</button>


<!-- For hide some time  -->


<button onclick="showMissingSerials()" 
        style="padding:8px 12px;border-radius:8px;border:1px solid #888;margin:6px 0;" id="showMissing">
  ğŸ” Show Missing Serials
</button>


       

        <!-- STATS -->
        <div class="stats-bar">
          
          <div class="stat-chip">Male: <span id="statMale" class="value">0</span></div>
          <div class="stat-chip">Female: <span id="statFemale" class="value">0</span></div>
          
<div class="stat-chip">Houses: <span id="statHouses" class="value">0</span></div>
          <div class="stat-chip">SC: <span id="statSC" class="value">0</span></div>
          <div class="stat-chip">OBC: <span id="statOBC" class="value">0</span></div>
          
          <div class="stat-chip stat-st" >ST: <span id="statST" class="value">0</span></div>
          
          <div class="stat-chip">
  General: <span id="statGeneral" class="value">0</span>
</div>
          <div class="stat-chip">Muslim: <span id="statMuslim" class="value">0</span></div>

          <div class="stat-chip stat-dup">Duplicate: <span id="statDup" class="value">0</span></div>
          
          <div class="stat-chip stat-verified">
  Verified: <span id="statVerified" class="value">0</span>
</div>

<div class="stat-chip stat-unverified">
  Unverified: <span id="statUnverified" class="value">0</span>
</div>
<div class="stat-chip stat-vmuslim">
  â˜ªï¸ Verified-Muslim:
  <span id="statVerifiedMuslim" class="value">0</span>
</div>

<div class="stat-chip stat-umuslim">
  â˜ªï¸ Unverified:
  <span id="statUnverifiedMuslim" class="value">0</span>
</div>
          <div class="stat-chip">
  Dup Serial: <span id="statDupSerial">0</span>
</div>
        </div>


<button id="resetFiltersBtn"
        style="margin-top:8px;padding:8px 14px;border-radius:10px;
        background:#f87171;color:#fff;border:none;cursor:pointer;">
  ğŸ”„ Reset Filters
</button>

</div>
</div>
<!-- ğŸ”¼ TOGGLE AREA END -->

</div>


      
      <!-- â­ / sticky-header ends -->
      
      <div id="lastUpdated"
     style="font-size:13px;color:#2563eb;margin-top:6px;font-weight:600;">
</div>
      
      <!-- â­ REPORT SECTION -->
<div id="reportSection" style="display:none;">

  <!-- ğŸ“Š Survey Report Box -->
  <div id="surveyReportBox" class="report-card">
    <h3 class="report-title">
      ğŸ“Š Survey Report
      <span class="report-icons">
        <i class="bi bi-pencil-square"></i>
        <i class="bi bi-trash3"></i>
      </span>
    </h3>

    <ul class="report-list">
      <li>ğŸ  Total Houses: <strong id="rptHouse">0</strong></li>
      <li>ğŸ§‘â€ğŸ¤â€ğŸ§‘ Total Voters: <strong id="rptVoters">0</strong></li>
      <li>ğŸ†• New Voters Today: <strong id="rptNew">0</strong></li>
      <li>ğŸ”„ Shift Voters: <strong id="rptShift">0</strong></li>
    </ul>

    <h3 class="report-subtitle">ğŸ†• Daily New Voter List</h3>
    <ul id="dailyReportList" class="styled-list"></ul>
  </div>

  <!-- â• Add New Voter Button -->
  <button id="addNewVoterBtn" class="styled-add-btn">
    â• Add New Voter
  </button>

  <!-- ğŸ” Shift Voter Section -->
  <h3 class="report-subtitle" style="margin-top:15px;">
    ğŸ” Daily Shift Voter List
  </h3>

  <ul id="dailyShiftList" class="styled-list shift-list"></ul>

  <!-- â• Add Shift Voter Button -->
  <button id="addShiftVoterBtn" class="styled-add-btn">
    â• Add Shift Voter
  </button>

<h3 class="report-subtitle" style="margin-top:20px;">ğŸ“Š Voter Charts</h3>

<canvas id="genderChart" style="margin-top:20px;"></canvas>
<canvas id="ageChart" style="margin-top:20px;"></canvas>

<canvas id="casteChart" style="margin-top:20px;"></canvas>
</div>
      <!-- RESULTS -->
      <div id="loadingSkeleton" class="loading-skeleton">
  Loading voters...
</div>

<div id="results"></div>


<div id="pagination" style="text-align:center;margin:20px 0;">
  <button id="prevPage" type="button">â¬… Prev</button>
  <span id="pageInfo"></span>
  <button id="nextPage" type="button">Next â¡</button>
  <input
  type="number"
  id="pageInput"
  min="1"
  placeholder="Page"
  style="
    width:70px;
    padding:6px;
    border-radius:6px;
    border:1px solid #cbd5e1;
    text-align:center;
  "
/>

<button id="goPageBtn">Go</button>
</div>
      
    </div>
  </main>
</div>

<!-- Back buttons -->
<button id="backToTop">â†‘ Top</button>
<button id="dupJumpBtn">ğŸ”</button>
<button id="muslimJumpBtn">â˜ªï¸</button>
<button id="unverifiedMuslimJumpBtn">â˜ªï¸âŒ</button>

<!-- Photo viewer -->
<div id="photoViewer" onclick="closePhoto()">
  <img id="fullPhoto">
</div>


<div id="newVoterPopup" style="
  position:fixed;top:0;left:0;width:100%;height:100%;
  background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center;z-index:999999;">
  
  <div style="background:#fff;padding:20px;border-radius:12px;width:85%;max-width:400px;">
    <h3>Add New Voter</h3>

    <input id="nvName" placeholder="Name" style="width:100%;margin-bottom:6px;padding:8px;">
    <input id="nvHouse" placeholder="House Number" style="width:100%;margin-bottom:6px;padding:8px;">
    <input id="nvFather" placeholder="Father / Husband Name" style="width:100%;margin-bottom:6px;padding:8px;">

    <button onclick="saveNewVoter()" 
    style="padding:10px;width:100%;border-radius:8px;background:#2563eb;color:#fff;">
      Save
    </button>
  </div>

</div>
</div>

<!-- SHIFT VOTER POPUP -->
<div id="shiftVoterPopup" class="popup-overlay">
  <div class="popup-box">
    <h3>Add Shift Voter</h3>
    <input id="svName" type="text" placeholder="Enter name" class="popup-input">
    <div class="popup-actions">
      <button class="popup-btn" onclick="saveShiftVoter()">Save</button>
      <button class="popup-btn close" onclick="document.getElementById('shiftVoterPopup').style.display='none'">Cancel</button>
    </div>
  </div>
</div>

<!-- Add voters popup -->

<div id="addVoterPopup" style="
display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);
align-items:center;justify-content:center;z-index:99999;">

  <div style="background:#fff;padding:20px;border-radius:16px;width:320px;">
    <h3 style="margin-bottom:10px;">â• Add New Voter</h3>
    
<input id="avSerial" placeholder="Serial Number" type="number"
       style="width:100%;margin-bottom:6px">
    <input id="avHouse" placeholder="House Number" style="width:100%;margin-bottom:6px">
    <input id="avName" placeholder="Name" style="width:100%;margin-bottom:6px">
    <input id="avFather" placeholder="Father Name" style="width:100%;margin-bottom:6px">
    <input id="avHusband" placeholder="Husband Name" style="width:100%;margin-bottom:6px">
    <input id="avAge" placeholder="Age" type="number" style="width:100%;margin-bottom:6px">
    <input id="avGender" placeholder="Gender (Male/Female)" style="width:100%;margin-bottom:6px">
    <input id="avBYP" placeholder="BYP" style="width:100%;margin-bottom:6px">
    <input id="avMobile" placeholder="Mobile Number" style="width:100%;margin-bottom:10px">

    <div style="display:flex;gap:10px;">
      <button onclick="saveAddVoter()" style="flex:1;background:#22c55e;color:#fff;border:none;padding:8px;border-radius:10px;">Save</button>
      <button onclick="closeAddVoter()" style="flex:1;background:#e5e7eb;border:none;padding:8px;border-radius:10px;">Cancel</button>
    </div>
  </div>
</div>

<!-- EDIT VOTER POPUP -->

<div id="editVoterPopup" style="
display:none;position:fixed;inset:0;background:rgba(0,0,0,.5);
align-items:center;justify-content:center;z-index:99999;">

  <div style="background:#fff;padding:20px;border-radius:16px;width:320px;">
    <h3 style="margin-bottom:10px;">âœï¸ Edit Voter</h3>


    <label style="font-size:13px;font-weight:600;color:#374151;">Serial Number</label>
    <input id="evSerial" type="number" placeholder="Serial Number"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">House Number</label>
    <input id="evHouse" placeholder="House Number"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Full Name</label>
    <input id="evName" placeholder="Name"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Father Name</label>
    <input id="evFather" placeholder="Father Name"
           style="width:100%;margin-bottom:8px">
           <label style="font-size:13px;font-weight:600;color:#374151;">Mother Name</label>
<input id="evMother" placeholder="Mother Name"
       style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Husband Name</label>
    <input id="evHusband" placeholder="Husband Name"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Age</label>
    <input id="evAge" type="number" placeholder="Age"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Gender</label>
    <input id="evGender" placeholder="Male / Female"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">BYP Number</label>
    <input id="evBYP" placeholder="BYP"
           style="width:100%;margin-bottom:8px">

    <label style="font-size:13px;font-weight:600;color:#374151;">Mobile Number</label>
    <input id="evMobile" placeholder="Mobile Number"
           style="width:100%;margin-bottom:12px">

    <div style="display:flex;gap:10px;">
      <button onclick="saveEditVoter()" 
        style="flex:1;background:#2563eb;color:#fff;border:none;padding:8px;border-radius:10px;">
        Update
      </button>

      <button onclick="closeEditVoter()" 
        style="flex:1;background:#e5e7eb;border:none;padding:8px;border-radius:10px;">
        Cancel
      </button>
    </div>

  </div>
</div>


<div id="muslimFloatCounter"
  style="
    position:fixed;
    right:16px;
    bottom:190px;
    background:#0f172a;
    color:#fff;
    padding:6px 12px;
    border-radius:999px;
    font-size:13px;
    font-weight:600;
    box-shadow:0 8px 20px rgba(0,0,0,.35);
    z-index:10000;
    display:none;
    transition:all .25s ease;
  ">
  1/1
</div>
<!-- ğŸ” DUPLICATE SERIAL JUMP BUTTON -->
<button id="dupSerialJumpBtn"
  style="
    position:fixed;
    bottom:110px;
    right:14px;
    padding:10px 14px;
    border-radius:999px;
    border:none;
    background:#f97316;
    color:#fff;
    font-weight:700;
    cursor:pointer;
    display:none;
    z-index:9999;
  ">
  ğŸ” Dup Serial
</button>

<!-- ğŸ”¢ DUPLICATE SERIAL COUNTER -->
<div id="dupSerialCounter"
  style="
    position:fixed;
    bottom:110px;
    right:14px;
    padding:6px 12px;
    border-radius:999px;
    background:#f97316;
    color:#fff;
    font-size:13px;
    font-weight:600;
    display:none;
    z-index:9999;
  ">
  1 / 1
</div>
<!-- ğŸ” FLOATING BULK MOVE BUTTON -->
<button id="bulkMoveBtnFloating"
  style="
    position:fixed;
    
    right:20px;
    padding:14px 16px;
    border-radius:999px;
    border:none;
    background:#2563eb;
    color:#fff;
    font-size:16px;
    font-weight:700;
    box-shadow:0 10px 25px rgba(0,0,0,.25);
    z-index:500;
  ">
  ğŸ” Move
</button>


<!-- ğŸ”„ GLOBAL SPINNER WITH PROGRESS BAR -->
<div id="globalSpinner" style="
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:2000;
">
  <div style="
    background:#fff;
    padding:24px 28px;
    border-radius:16px;
    text-align:center;
    min-width:240px;
  ">

    <!-- Spinner -->
    <div style="
      width:42px;
      height:42px;
      margin:0 auto 12px;
      border:5px solid #e5e7eb;
      border-top:5px solid #2563eb;
      border-radius:50%;
      animation:spin 1s linear infinite;
    "></div>

    <!-- Text -->
    <div id="spinnerText"
      style="font-size:14px;font-weight:600;margin-bottom:8px;">
      Processing...
    </div>

    <!-- Progress bar -->
    <div style="height:8px;background:#e5e7eb;border-radius:999px;overflow:hidden;">
      <div id="spinnerBar" style="
        height:100%;
        width:0%;
        background:#2563eb;
        transition:width .3s;
      "></div>
    </div>

    <!-- ETA -->
    <div id="spinnerEta"
      style="font-size:12px;color:#555;margin-top:6px;">
      Estimating timeâ€¦
    </div>

    <!-- Cancel -->
    <button id="spinnerCancel"
      style="
        margin-top:12px;
        padding:6px 14px;
        border-radius:999px;
        border:1px solid #dc2626;
        background:#fff;
        color:#dc2626;
        font-weight:600;
      ">
      Cancel
    </button>

  </div>
</div>

<style>
@keyframes spin{ to{ transform:rotate(360deg); } }
</style>

<script>
function openPhoto(src){
  fullPhoto.src=src;
  photoViewer.style.display="flex";
}
function closePhoto(){
  photoViewer.style.display="none";
}
</script>


<!-- Main logic -->
<script type="module" src="script.js"></script>

<!-- Pending badge logic -->
<script type="module" src="pending-indicator.js"></script>

<footer class="app-footer">
  Â© 2025 â€¢ Polling Station 90 â€¢ Developed by Bijush Kumar Roy
</footer>
<!--
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>
-->
</body>
</html>
